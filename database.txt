-- Locations table
CREATE TABLE locations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    country VARCHAR(100) NOT NULL,
    region VARCHAR(100),
    currency_code VARCHAR(3) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(name, country)
);

-- Job Categories
CREATE TABLE job_categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    has_performance_bonuses BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Jobs table
CREATE TABLE jobs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    category_id UUID NOT NULL REFERENCES job_categories(id),
    location_id UUID NOT NULL REFERENCES locations(id),
    title VARCHAR(150) NOT NULL,
    base_salary DECIMAL(12,2) NOT NULL,
    max_salary DECIMAL(12,2) NOT NULL,
    role_level VARCHAR(20) NOT NULL,
    bonus_eligible BOOLEAN DEFAULT false,
    bonus_rate DECIMAL(4,2) DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    CONSTRAINT valid_salary_range CHECK (max_salary >= base_salary),
    CONSTRAINT valid_role CHECK (role_level IN ('junior', 'mid', 'senior', 'executive'))
);

----------------------

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(50) UNIQUE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- Privacy settings
    show_in_leaderboards BOOLEAN DEFAULT true,
    show_focus_stats BOOLEAN DEFAULT true,
    show_earnings BOOLEAN DEFAULT true,
    show_job_stats BOOLEAN DEFAULT true,
    
    -- Profile
    avatar_customization JSONB DEFAULT '{}',
    total_currency DECIMAL(15,2) DEFAULT 0,
    
    -- Current job info
    current_job_id UUID REFERENCES jobs(id),
    current_location_id UUID REFERENCES locations(id),
    current_salary DECIMAL(12,2) DEFAULT 0,
    
    -- Constraints
    CONSTRAINT valid_username CHECK (length(username) >= 3),
    CONSTRAINT positive_currency CHECK (total_currency >= 0)
);

------------------------

CREATE TABLE focus_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    session_type VARCHAR(20) DEFAULT 'standard',
    start_time TIMESTAMP WITH TIME ZONE NOT NULL,
    end_time TIMESTAMP WITH TIME ZONE,
    duration_minutes INTEGER,
    manually_added BOOLEAN DEFAULT false,
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    CONSTRAINT valid_duration CHECK (
        (manually_added = true AND duration_minutes > 0) OR
        (manually_added = false AND end_time > start_time)
    )
);